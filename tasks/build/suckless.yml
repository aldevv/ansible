- name: install suckless programs 
  block:
  - include_role:
      name: update 
  - include_role:
      name: base-devel
  - include_role:
      name: suckless

  - name: Clone suckless programs
    git:
      repo: 'https://github.com/aldevv/suckless'
      dest: "{{ suckless_home }}"
      recursive: true
      depth: 1

  - name: Build all suckless programs
    become: true
    shell: "make clean && make && make PREFIX={{builds}}/{{item}} install && stow -d {{builds}} {{item}}"
    args:
      chdir: "{{ suckless_home }}/{{ item }}"
    loop:
      - "st"
      - "dmenu"
      - "dwm"
      - "dragon"

  - name: Create xsessions file for dwm
    become: true
    shell: |
      [ ! -d "/usr/share/xsessions" ] && mkdir -p "/usr/share/xsessions"
      cat > /usr/share/xsessions/dwm.desktop << EOF
      [Desktop Entry]
      Name=Dwm
      Type=Application
      Exec=dwm
      EOF

  tags:
    - install
    - suckless
    - st
    - dmenu
    - dwm
    - dragon
