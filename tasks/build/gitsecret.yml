- name: Install git-secret
  block:
  - name: Add Git-Secret repository to apt
    become: true
    shell: |
      # Add the repository to a new sources list file
      echo 'deb https://gitsecret.jfrog.io/artifactory/git-secret-deb git-secret main' | sudo tee /etc/apt/sources.list.d/git-secret.list
      # Add the GPG key
      wget -qO - 'https://gitsecret.jfrog.io/artifactory/api/gpg/key/public' | sudo gpg --dearmor -o /usr/share/keyrings/git-secret.gpg --yes

    args:
      executable: /bin/bash

  - name: install Git secret
    become: true
    apt:
      name: git-secret
      state: present

  - name: Reveal secrets
    shell: |
        SECRETS_EXTENSION=.scr git secret reveal
    args:
      chdir: "{{dotfiles}}/personal"
  tags:
    - install
    - gitsecret
